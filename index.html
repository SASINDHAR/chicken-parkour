<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Chicken Parkour 2: Fried or Alive üçóüî•</title>
<style>
  :root{--bg:#071026;--ground:#2a2a2a;--hud:#fff}
  html,body{height:100%;margin:0;background:linear-gradient(#071026,#031026);color:var(--hud);font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial}
  #game{display:block;margin:18px auto;border-radius:10px;box-shadow:0 12px 40px rgba(0,0,0,0.6);background:var(--bg)}
  .info{max-width:980px;margin:6px auto;text-align:center}
  .chip{display:inline-block;background:rgba(255,255,255,0.05);padding:8px 12px;border-radius:999px;margin:4px}
  #ticker{position:fixed;left:0;right:0;top:0;padding:6px 8px;text-align:center;background:#ff3b30;color:#fff;font-weight:700}
  #popup{position:fixed;left:50%;transform:translateX(-50%);top:52px;background:rgba(0,0,0,0.6);padding:8px 12px;border-radius:8px;display:none}
  #ad{position:fixed;left:50%;transform:translateX(-50%);bottom:40px;background:linear-gradient(90deg,#ffd54a,#ff7043);color:#111;padding:10px 18px;border-radius:10px;display:none;font-weight:800}
  button.chip{cursor:pointer;border:0;background:#333;color:#fff}
  footer{max-width:980px;margin:18px auto;text-align:center;color:#9fb0c6;font-size:13px}
</style>
</head>
<body>
<div id="ticker">BREAKING: Chicken thinks this is a good idea</div>
<canvas id="game" width="960" height="420"></canvas>
<div class="info">
  <span class="chip" id="score">Score: 0</span>
  <span class="chip" id="best">Best: 0</span>
  <span class="chip" id="power">Power: ‚Äî</span>
  <button class="chip" id="restartBtn">Restart</button>
</div>
<div id="popup"></div>
<div id="ad">Sponsored by Definitely-Not-a-Franchise‚Ñ¢ ‚Äî Buy fries!</div>
<footer>Made funnier: power-ups, roasts, and clucky sounds. Press Space / ‚Üë to jump.</footer>

<script>
(() => {
  // Canvas + context
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const W = canvas.width, H = canvas.height;
  const groundY = H - 80;

  // HUD elements
  const scoreEl = document.getElementById('score');
  const bestEl = document.getElementById('best');
  const powerEl = document.getElementById('power');
  const ticker = document.getElementById('ticker');
  const popup = document.getElementById('popup');
  const ad = document.getElementById('ad');
  const restartBtn = document.getElementById('restartBtn');

  // Game state
  let score = 0, best = Number(localStorage.getItem('cp_best')||0);
  bestEl.textContent = 'Best: ' + best;
  let tick = 0, speed = 4, spawnTimer = 0, spawnRate = 80;
  let obstacles = [], powerups = [], particles = [];
  let spawnPowerTimer = 0;
  let messagesTimer = 0;

  // Player (chicken)
  let player = { x:120, y: groundY - 48, w:48, h:48, vy:0, jumps:0, alive:true, shield:false, extraJumpExpiry:0 };

  // Sound (WebAudio) - small helper sounds
  const AudioCtx = window.AudioContext || window.webkitAudioContext;
  const aCtx = new AudioCtx();

  function shortBeep(freq=800, duration=0.08, type='sine', gain=0.12){
    const o = aCtx.createOscillator();
    const g = aCtx.createGain();
    o.type = type; o.frequency.value = freq;
    g.gain.value = 0;
    o.connect(g); g.connect(aCtx.destination);
    const now = aCtx.currentTime;
    o.start(now);
    g.gain.linearRampToValueAtTime(gain, now + 0.01);
    g.gain.exponentialRampToValueAtTime(0.001, now + duration);
    o.stop(now + duration + 0.02);
  }
  function playCluck(){ shortBeep(720,0.09,'square',0.14); }
  function playJump(){ shortBeep(980,0.06,'sine',0.09); }
  function playCollect(){ shortBeep(1200,0.12,'triangle',0.16); }
  function playFail(){ shortBeep(220,0.28,'sawtooth',0.18); }
  function playExplode(){ shortBeep(120,0.45,'sawtooth',0.3); shortBeep(360,0.22,'sine',0.16); }

  // Messages, roasts, tickers
  const roasts = [
    "You tasted the ground. Crunchy.",
    "Nugget status: achieved.",
    "Colonel Sanders is disappointed.",
    "Bro, even the egg left you.",
    "Gravity: 1 ‚Äî You: 0"
  ];
  const jumpQuips = [
    "WHY DID YOU JUMP, BRO??",
    "WAS THAT A FLAP OR A FACEPLANT?",
    "You call that parkour?",
    "I BELIEVE IN YOU (not really)."
  ];
  const tickerPool = [
    "LIVE: Chicken contemplates life choices.",
    "ALERT: Player still discovers 'wall' mechanic.",
    "SPORTS: Chicken loses wings to physics.",
    "WEATHER: 100% chance of crumbs."
  ];

  // Power-up types
  const POWER_TYPES = [
    {id:'egg', emoji:'ü•ö', name:'Egg Shield', desc:'Protects you (usually).', duration: 8000},
    {id:'spice', emoji:'üå∂Ô∏è', name:'Spicy Mode', desc:'Speedy but chaotic!', duration: 7000},
    {id:'boost', emoji:'üéÅ', name:'Cluck Booster', desc:'Extra mid-air jump!', duration: 8000}
  ];

  // helpers
  function rand(a,b){ return Math.random()*(b-a)+a; }
  function showPopup(text, ttl=1600){
    popup.style.display='block'; popup.textContent = text;
    popup.style.opacity = '1';
    setTimeout(()=>{ popup.style.opacity = '0'; setTimeout(()=>popup.style.display='none',300); }, ttl);
  }
  function showAd(ttl=1500){
    ad.style.display='block'; ad.style.opacity='1';
    setTimeout(()=>{ ad.style.opacity='0'; setTimeout(()=>ad.style.display='none',300); }, ttl);
  }

  // Input
  let keys = {};
  window.addEventListener('keydown', e=>{
    keys[e.code]=true;
    if((e.code==='Space' || e.code==='ArrowUp') && player.alive){ jump(); }
    if(!player.alive && (e.code==='Space' || e.code==='KeyR')) restart();
    // unlock audio context on first interaction if suspended
    if(aCtx.state === 'suspended') aCtx.resume();
  });
  window.addEventListener('keyup', e=> keys[e.code]=false);
  restartBtn.addEventListener('click', ()=>{ if(!player.alive) restart(); });

  // Game mechanics
  function jump(){
    if(player.jumps < (player.extraJumps||2)){
      player.vy = -13 - (player.jumps*1.6);
      player.jumps++;
      playJump();
      showRandomQuip();
      // small particle burst
      for(let i=0;i<8;i++) particles.push({x:player.x+player.w/2, y:player.y+player.h/2, vx:rand(-3,3), vy:rand(-7,-2), life:40});
    } else {
      // useless flail sound
      shortBeep(420,0.06,'square',0.04);
    }
  }

  function showRandomQuip(){
    if(Math.random()<0.7){
      const q = jumpQuips[Math.floor(rand(0,jumpQuips.length))];
      showPopup(q, 900);
    }
  }

  function spawnObstacle(){
    const type = Math.random() < 0.12 ? 'truck' : 'fire';
    const o = {
      x: W + 40 + rand(0,160),
      y: groundY - (type==='truck' ? 56 : 40),
      w: type==='truck' ? 100 : 44,
      h: type==='truck' ? 56 : 44,
      tag: type,
      vx: -(speed + rand(0,1.6))
    };
    obstacles.push(o);
  }

  function spawnPowerup(){
    const t = POWER_TYPES[Math.floor(rand(0, POWER_TYPES.length))];
    const p = {
      x: W + 40 + rand(0,160),
      y: groundY - 120 - rand(0,80),
      w: 38, h: 38,
      type: t,
      vx: -(speed*0.9 + rand(0,1.2))
    };
    powerups.push(p);
  }

  function rectIntersect(a,b){
    return !(a.x+a.w < b.x || a.x > b.x + b.w || a.y + a.h < b.y || a.y > b.y + b.h);
  }

  function applyPowerUp(p){
    if(!p || !p.type) return;
    const id = p.type.id;
    powerEl.textContent = 'Power: ' + p.type.name;
    playCollect();
    // occasionally show ad (troll)
    if(Math.random() < 0.22) { showAd(1100); }

    if(id === 'egg'){
      // egg shield - 30% chance to betray you (funny)
      player.shield = true;
      showPopup(p.type.emoji + ' ' + p.type.name + ' (may crack...)', 1400);
      // schedule shield expiry with a chance to crack early
      setTimeout(()=>{
        if(Math.random() < 0.30){
          // betrayed
          showPopup('Oh no ‚Äî the Egg betrayed you! ü•öüí•', 1500);
          playFail();
          player.shield = false;
        } else {
          showPopup('Egg held! You are briefly safe üõ°Ô∏è', 1200);
          playCluck();
          player.shield = false;
        }
      }, p.type.duration);
    } else if(id === 'spice'){
      // spicy: increase speed but it's risky (player laughs)
      const oldSpeed = speed;
      speed += 2.6;
      showPopup('SPICY MODE ENABLED! üî• (chaos)', 1400);
      // spicy makes ticker angry
      ticker.textContent = 'SPICE ALERT: Everything is getting hot!';
      setTimeout(()=>{ speed = oldSpeed; ticker.textContent = tickerPool[Math.floor(rand(0,tickerPool.length))]; showPopup('Spice wore off. You survived... this time.',1200); }, p.type.duration);
    } else if(id === 'boost'){
      // cluck booster: grant an extra jump (3 total) for a while
      player.extraJumps = 3;
      player.extraJumpExpiry = Date.now() + p.type.duration;
      showPopup('Cluck Booster: extra jump! üêî‚ú®', 1400);
      setTimeout(()=>{ player.extraJumps = 2; showPopup('Booster expired. Back to reality.', 1200); }, p.type.duration);
    }
  }

  function explode(x,y,count){
    playExplode();
    for(let i=0;i<count;i++) particles.push({x:x, y:y, vx:rand(-6,6), vy:rand(-8,2), life:40+Math.random()*40});
  }

  function die(){
    player.alive = false;
    playExplode();
    explode(player.x + player.w/2, player.y + player.h/2, 30);
    const roast = roasts[Math.floor(rand(0,roasts.length))];
    showPopup(roast, 2200);
    if(Math.floor(score/10) > best){ best = Math.floor(score/10); localStorage.setItem('cp_best', best); bestEl.textContent = 'Best: ' + best; }
  }

  // Game loop: update + draw
  function update(){
    if(!player.alive) return;
    tick++;
    score += 1;
    if(tick % 600 === 0){
      speed += 0.6;
      spawnRate = Math.max(30, spawnRate - 6);
      ticker.textContent = tickerPool[Math.floor(rand(0,tickerPool.length))];
    }
    scoreEl.textContent = 'Score: ' + Math.floor(score/10);

    // spawn obstacles
    spawnTimer++;
    if(spawnTimer > spawnRate + Math.floor(rand(-12,40))){
      spawnObstacle(); spawnTimer = 0;
    }
    // spawn powerup occasionally
    spawnPowerTimer++;
    if(spawnPowerTimer > 550 + Math.floor(rand(-100,120))){
      spawnPowerup(); spawnPowerTimer = 0;
    }

    // player physics
    player.vy += 0.85;
    player.y += player.vy;
    if(player.y + player.h >= groundY){
      player.y = groundY - player.h; player.vy = 0; player.jumps = 0;
    }

    // move obstacles
    for(let i=obstacles.length-1;i>=0;i--){
      const o = obstacles[i];
      o.x += o.vx;
      // tiny wobble for fun
      if(Math.random() < 0.006) o.vx -= 0.2;
      if(o.x + o.w < -120) obstacles.splice(i,1);
      // collision
      if(rectIntersect(player, o)){
        // if shield active, maybe save you (but egg may already have been used)
        if(player.shield){
          // shield takes one hit
          player.shield = false;
          showPopup('Egg cracked but you survived! ü•ö‚Üíüí•', 1200); playCluck();
          obstacles.splice(i,1);
        } else {
          die(); return;
        }
      }
    }

    // move powerups
    for(let i=powerups.length-1;i>=0;i--){
      const p = powerups[i];
      p.x += p.vx;
      if(p.x + p.w < -60) powerups.splice(i,1);
      if(rectIntersect(player, p)){
        // collect
        playCollect();
        applyPowerUp(p);
        powerups.splice(i,1);
      }
    }

    // particles
    for(let i=particles.length-1;i>=0;i--){
      const p = particles[i];
      p.vy += 0.25;
      p.x += p.vx; p.y += p.vy; p.life--;
      if(p.life <= 0) particles.splice(i,1);
    }

    // auto expire booster if time passed
    if(player.extraJumpExpiry && Date.now() > player.extraJumpExpiry){
      player.extraJumps = 2; player.extraJumpExpiry = 0;
    }
  }

  function draw(){
    // background
    ctx.clearRect(0,0,W,H);
    const g = ctx.createLinearGradient(0,0,0,H);
    g.addColorStop(0,'#071026'); g.addColorStop(1,'#051027');
    ctx.fillStyle = g; ctx.fillRect(0,0,W,H);

    // far hills
    for(let i=0;i<6;i++){
      ctx.fillStyle = `rgba(40,60,70,${0.04 + i*0.02})`;
      const hx = (i*180 + (score*0.02*(i%2?1:-1))) % (W+200) - 100;
      ctx.beginPath(); ctx.ellipse(hx, groundY-30 - i*6, 220 - i*18, 60 - i*8, 0, 0, Math.PI*2); ctx.fill();
    }

    // ground
    ctx.fillStyle = '#272727';
    ctx.fillRect(0, groundY, W, H-groundY);
    for(let x=0;x<W;x+=38){ ctx.fillStyle = x%76===0 ? '#2f2f2f' : '#262626'; ctx.fillRect((x + (score*0.38 % 38)), groundY+36, 38, 6); }

    // obstacles
    obstacles.forEach(o=>{
      ctx.save();
      ctx.translate(o.x + o.w/2, o.y + o.h/2);
      ctx.rotate(Math.sin(o.x*0.02)*0.03);
      ctx.font = (o.h) + 'px serif';
      ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
      ctx.fillText(o.tag==='truck' ? 'üõª' : 'üî•', 0, 0);
      ctx.restore();
    });

    // power-ups
    powerups.forEach(p=>{
      ctx.save();
      ctx.translate(p.x + p.w/2, p.y + p.h/2);
      ctx.rotate(Math.sin(p.x*0.05)*0.08);
      ctx.font = (p.h - 2) + 'px serif';
      ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
      ctx.fillText(p.type.emoji, 0, 0);
      ctx.restore();
      // tiny label
      ctx.font = '10px sans-serif'; ctx.fillStyle = 'rgba(255,255,255,0.7)';
      ctx.fillText(p.type.name, p.x + p.w/2, p.y + p.h + 12);
    });

    // player (chicken)
    ctx.save();
    ctx.translate(player.x + player.w/2, player.y + player.h/2);
    ctx.rotate(Math.sin(score/18) * (player.vy*0.02));
    ctx.font = player.h + 'px serif'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
    ctx.fillText('üêî', 0, 0);
    ctx.restore();

    // shield indicator
    if(player.shield){
      ctx.beginPath(); ctx.arc(player.x + player.w/2, player.y + player.h/2, player.w, 0, Math.PI*2);
      ctx.strokeStyle = 'rgba(255,255,255,0.12)'; ctx.lineWidth = 6; ctx.stroke();
    }

    // particles
    particles.forEach(p=>{
      ctx.globalAlpha = Math.max(0, Math.min(1, p.life/60));
      ctx.beginPath(); ctx.arc(p.x, p.y, 3 + Math.abs(p.vx)*0.4, 0, Math.PI*2); ctx.fill();
    });
    ctx.globalAlpha = 1;

    // overlay if dead
    if(!player.alive){
      ctx.fillStyle = 'rgba(0,0,0,0.6)'; ctx.fillRect(0,0,W,H);
      ctx.fillStyle = '#fff'; ctx.font='28px sans-serif'; ctx.textAlign='center';
      ctx.fillText('You died. Press Space or Restart to try again.', W/2, H/2 - 10);
      ctx.font='18px sans-serif'; ctx.fillText('Hint: Egg shields may betray you (or not).', W/2, H/2 + 18);
    }
  }

  function loop(){
    update(); draw();
    requestAnimationFrame(loop);
  }

  // start
  loop();

  // utility: random ticker updates
  setInterval(()=>{ if(Math.random()<0.35) ticker.textContent = tickerPool[Math.floor(rand(0,tickerPool.length))]; }, 4500);

  // expose functions for small UI
  function restart(){
    obstacles = []; powerups = []; particles = []; score = 0; tick = 0; speed = 4; spawnRate = 80; spawnTimer = 0; spawnPowerTimer = 0;
    player = { x:120, y: groundY - 48, w:48, h:48, vy:0, jumps:0, alive:true, shield:false, extraJumpExpiry:0, extraJumps:2 };
    powerEl.textContent = 'Power: ‚Äî';
    showPopup('Ready... Cluck!', 900);
  }
  function restartIfDead(){ if(!player.alive) restart(); }
  // attach to restart button
  function restartButtonHandler(){ if(!player.alive){ restart(); } else { showPopup('You can still play!'); } }
  restartBtn.addEventListener('click', restartButtonHandler);

  // expose restart for external call
  window.restart = restart;

  // unlock audio on mobile click (some browsers require user gesture)
  canvas.addEventListener('touchstart', ()=>{ if(aCtx.state==='suspended') aCtx.resume(); }, {passive:true});
})();
</script>
</body>
</html>
